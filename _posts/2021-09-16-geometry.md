---
layout: post
title:  "Geometry"
author: seri
categories: [ computer vision ]
image: assets/images/pointvec.png
tags: featured
exerpt: "Geometry is a branch of mathematics concerned with questions of shape, size, relative position of figures, and the properties of space. Points, vectors, and matrices are instrumental in the process of making computer vision/graphics images; In this blog post, you will learn what these constructs are, how they work and the various techniques that can be used to manipulate them."
---

<!--more-->
<h2> Coordinate Systems </h2>

<h3> Introducing Coordinate Systems </h3>

Coordinate systems play an essential role in the graphics pipeline. They are not complicated; However, learning a few things about them will make it easier to understand matrices.

I mentioned that points and vectors (as used in computer vision/graphics) are represented with 3 real numbers. But what do these numbers mean? Each number represents <span class="blue"> a signed distance </span> from the origin of a line to the position of the point on that line. 

Consider drawing a line and putting a mark in the middle. We will call this mark origin. This mark becomes our point of reference: the position from which we will measure the distance to any other points. If a point lies to the right side of the origin, we take the signed distance to be greater than zero. On the other hand, if it is on the left side of the origin, the values will be negative.

Now that we have a line and an origin, we add some additional marks at a regular interval (unit length) on each side of the origin, effectively turning our line into a ruler. With the ruler established, we can simply use it to measure the coordinate of a point from the origin (coordinate is another way of saying the signed distance from the origin to the point). In mathematics, the ruler defines what we call <span class="red"> axis </span>. We have just learned to define the coordinate of a point along an axis. 

<h3> Dimensions and Cartesian Coordinate Systems </h3>

By placing two axes called $x$-axis and $y$-axis, we have defined a two dimensional space called a <span class="neon"> plane </span>. These two axes are said to define a coordinate system. <span class="underline"> If these two rulers are perpendicular to each other, they define what we call a Cartesian coordinate system. </span>

We now know how to make a two-dimensional Cartesian coordinate system and define the coordinates of a 2D point in that coordinate system. Note that <mark class="gold"> the coordinates of points defined in a coordinate system are unique </span>. The same point cannot be represented by two different sets of coordinates in one system. We are free to choose any coordinate system that we please. 

<picture><img src="{{site.baseurl}}/assets/images/axis2d.png" style="width: 300px !important;float: left !important; margin: 0px 0px 25px 25px !important;"><img src="{{site.baseurl}}/assets/images/coor.png" style="width: 300px !important; float: left !important; margin: 0px 0px 25px 25px !important;"></picture>

In fact, we can choose to define infinitely many coordinate systems in a plane. Let's assume we drew two Cartesian coordinate system like the figure above. On this paper, we place one point. <span class="stroke"> The coordinates of that point will be different </span> depending on which of the two coordinate system we consider. 

<span class="highlight-gradient"> If you know the coordinates of $P$ in coordinate system $A$, </span> what do you need to do <span class="underline-pink"> to find the coordinate of the same point in another coordinate system $B$? </span> This represents an extremely important operation in computer vision, and we will soon learn why and how to find the map which translates the coordinates of a point from one coordinate system to another.

Another common operation is to move the point in the coordinate system $A$ to another location in the same coordinate system. This is called a <span class="gradient"> translation </span> and is certainly one of the basic operations you can do on points. 

Note that all sorts of other linear operators can be applied to point coordinates. A multiplication of a real number to the coordinate of point produces <span class="blue"> scale </span>. A scale moves $P$ along the line that is going through the point and the origin. That is because when we are transforming a point we are actually transforming the vector going from origin to the point. 

<h3> The Third Dimension </h3>

The 3D coordinate system is a simple extension of the 2D case. We will be adding a third axis orthogonal to both the $x$- and $y$-axis called the $z$-axis (representative of depth). In geometry, 3D coordinate system defines what is more formally known as <span class="blink"> Euclidean Space </span>. In linear algebra, the three axes from what we call the <span class="flow"> basis </span> of that coordinate system. 

A basis is a set of linearly independent vectors that, in a linear combination, can represent every vector (or point) in a given vector space (the coordinate system). 

<div class="sidenote"> Vectors from a set are said to be linearly independent if and only if none of the vectors in the set can be written as a linear combination of other vectors in that set. </div>

Change of basis, or change of coordinate system, is a common operation in mathematics and computer vision pipeline.

<h3> Left-Handed vs Right-Handed Coordinate Systems </h3>

<picture><img src="{{site.baseurl}}/assets/images/rhlh.png"></picture>

Unfortunately, due to various conventions concerning handedness, coordinate systems are not that simple. The problem can be illustrated in the following figure: when the up and forward vectors are oriented in the same way, an appropriate right vector can either point to the left or to the right.

To differentiate the two conventions, we call the first coordinate system the left-handed coordinate system, and the other, the right-handed coordinate system. 

<mark class="coral"> Remember that the middle finger always represent the right vector when checking the coordinate handedness. </mark> 

<div class="blockquote"> The handedness of the coordinate system also plays a role in the orientation of normals computed from the edges of polygonal faces. If the orientation is right-handed, then polygons whose vertices were specified in counterclockwise order will be front-facing. This will be explained in the part on rendering polygon objects. </div>

<h3> The Right, Up and Forward Vectors </h3>

The Cartesian coordinate system is only defined by three perpendicular vectors of unit length. As far as the mathematical notation is concerned, this coordinate system does not convey anything about what these three axes actually mean. The developer is the one that decides how these axes should be interpreted. It is thus very important to make a clear distinction between the handedness of the coordinate system and the conventions used to label the corresponding axes. 

The choice of coordinate system handedness also plays a critical role when it comes to rotation and the cross product of two vectors. It's actually easy enough (but painful) to go from one coordinate system to another. All that is needed is to scale the point coordinates and the camera-to-world matrix by $(1,1,-1)$. 

<h3> The World Coordinate System </h3>

In most 3D applications, each different type of coordinate system is defined with respect to a master coordinate system called the world coordinate system. It defines the origin and the main $x$,$y$,$z$-axes from which all other coordinate systems are defined. 

<h2> Math Operations on Points and Vectors </h2>

I have explained the concept of (Cartesian) coordinate system. Now we can look at some of the most common operations which can be performed on points and vectors. 

<h3> Vector Length </h3> 

The vector itself indicates not only the direction of point $B$ from $A$ but also can be used to find out the distance between $A$ and $B$. This is given by the length of a vector which can easily be computed with the following formula:

$$
\lVert V \rVert = \sqrt{x^2 + y^2 + z^2}
$$

<mark class="teal"> The vector's length is sometimes also called norm or magnitude. </mark> Note that the axes of the three-dimensional Cartesian coordinate systems are unit vectors. 

<h3> Normalizing a Vector </h3>

<span class="red"> A normalized vector is a vector whose length is 1.</span> Such a vector is also called a unit vector (it is a vector which has unit length). Normalizing a vector is very simple. We first compute the length of the vector and divide each one of the vector coordinates with this length. 

$$
\hat{V} = \frac{V}{\lVert V \rVert}
$$

In mathematics, you will also find the term norm to define a function that assigns a length or size (or distance) to a vector. The function we have just described is called the Euclidean norm.

<h3> Dot Product </h3>

The dot product or scalar product requires two vectors $A$ and $B$ and can be seen as the projection of one vector onto the other. The result of the dot product is a real number. A dot product between two vectors is denoted with the dot sign: $A \cdot B$ (it can also sometimes be written as $<A,B>$). 

The dot product consists of multiplying each element of the $A$ vector with its counterpart from vector $B$ and taking the sum of each product. In the case of 3D vectors (they have three coefficients of elements which are $x$, $y$ and $z$), it consists of the following operation:

$$
A \cdot B = A.x * B.x + A.y * B.y + A.z * B.z
$$

Note that this is quite similar to the way we compute the length of a vector. If we take the square root of the dot product between two vectors ($\sqrt{A \cdot B}$) that are equal ($A=B$), then what we get is the length of the vector. We can write:

$$
{\lVert V \rVert}^2 = V \cdot V
$$

<picture><img src="{{site.baseurl}}/assets/images/dotproduct.png" style="width: 300px !important;float: left !important; margin: 0px 0px 25px 25px !important;"></picture>

The dot product between two vectors is an extremely important and common operation in any 3D application because the result of this operation relates to the cosine of the angle between the two vectors. In this example vector $A$ is projected in the direction of vector $B$. 

<ul><li> If $B$ is a unit vector then the product $A \cdot B$ gives $\lVert A \rVert \cos (\theta)$, the magnitude of the projection of $A$ in the direction of $B$, with a minus sign if the direction is opposite. This is called the scalar projection of $A$ onto $B$. </li>

<li> When neither $A$ nor $B$ is a unit vector, we can write that $A \cdot B / \lVert B \rVert$, since $B$ as a unit vector is $B/\lVert B rVert$. </li>

<li> In mathematics, $ {\cos}^{-1}$ is the inverse of the cosine function. When the two vectors are normalized ($A \cdot B / \lVert A \rVert \lVert B \rVert$), taking the arc cosine of the dot product gives you the angle $\theta$ between two vectors: $\theta = {\cos}^{-1}(A \cdot B / \lVert A \rVert \lVert B \rVert)$ or $\theta = {\cos}^{-1}(\hat{A} \cdot \hat{B})$. </li><ul>


<div class="sidenote"> <picture><img src="{{site.baseurl}}/assets/images/dot.png" style="width: 300px !important;float: left !important; margin: 0px 0px 25px 25px !important;"></picture>
The dot product is a very important operation in 3D. It can be used for many things. As a test of orthogonality. When two vectors $A$,$B$ are perpendicular to each other, the result of the dot product between these two vectors is $0$. 

It is also used intensively to find out the angle between two vectors or compute the angle between a vector and the axis of a coordinate system. </div> 

<h3> Cross Product </h3>

The cross product is also an operation on two vectors. The difference between cross product and dot product is that the dot product returns a number, whereas the cross product returns a vector. 

The particularity of this operation is that <mark class="blue"> the vector resulting from the cross product is perpendicular to the other two. </mark> The cross product operation is written using the following syntax:

$$
C = A \times B
$$

<picture><img src="{{site.baseurl}}/assets/images/crossproduct.png" style="width: 300px !important;"></picture>

To compute the cross product we will need to implement the following formula:

$$
C_x = A_Y * B_Z - A_Z * B_Y
C_Y = A_Z * B_X - A_X * B_Z
C_Z = A_X * B_Y - A_Y * B_X
$$

The result of this cross product is another vector which is <span class="reveal">  orthogonal </span> to the other two. The two vectors $A$ and $B$ define a plane and the resulting vector $C$ is perpendicular to that plane. 

$A$ and $B$ don't have to be perpendicular to each other, but when they are, the resulting $A$, $B$ and $C$ vectors form a Cartesian coordinate system (assuming the vectors have unit length).

If you need a mnemonic way of remembering this formula, we like to use the technique that consists of asking ourselves the question "why z?". $y$ and $z$ being the coordinates of vector $A$ and $B$ used to compute the $x$ coordinates of the resulting vector $C$. 

It is important to note that the order of the vectors involved in the cross product has an effect on the resulting vector $C$. You can see that $A \times B$ doesn't give you the same result as $B \times A$. 

<h2> How Does Matrix Work </h2>

<h3> Point-Matrix Multiplication </h3>

Two matrices need to have compatible sizes in order to be multiplied with each other. For instance, the matrices of size $m \times p$ and $p \times n$ can be multiplied with each other. In computer vision, we would primarily deal with $4 \times 4$ matrices. 

Point can be written in a matrix form $P = [xyz]$. There is two things we need to remember. The first one is that a point multiplied by a matrix transforms the point to a new position. The result of a point multiplied by a matrix has to be a point.

The second thing we need to remember is that a $m \times p$ matrix multiplied by $p \times n$ matrix, gives a $m \times n$ matrix. Multiplying a $1 \times 3$ matrix by a $3 \times 3$ matrix gives as expected, a $1 \times 3$ matrix which is another point.

<h3> The Identity Matrix </h3>

The identity matrix or unit matrix is a square matrix whose coefficients are all 0 except the coefficients along the diagonal which are set to $1$. 

$$
\begin{bmatrix}
1 & 0 & 0 \\
0 & 1 & 0 \\
0 & 0 & 1
\end{bmatrix}
$$

The result of $P$ multiplied by the identity matrix is $P$. 

<h3> The Scaling Matrix </h3>

When these coefficients of the identity matrix are different than 1 (whether smaller or bigger than 1), then they act as a multiplier on the point's coordinates. In other words, the points coordinates are scaled up or down by some amount.

$$
\begin{bmatrix}
S_X & 0 & 0 \\
0 & S_Y & 0 \\
0 & 0 & S_Z
\end{bmatrix}
$$

Note that <mark class="coral"> if either one of the scaling coefficiuent in the matrix are negative, then the point's coordinate for the corresponding axis will be flipped </mark> (it will be mirrored to the other side of the matrix).

<h3> The Rotation Matrix </h3>

We are now talking about building a matrix that will rotate a point or a vector around one axis of the cartesian coordinate system. And for doing so, we will need to use trigonometric functions. 

<picture><img src="{{site.baseurl}}/assets/images/rotation-mat.png" style="width: 300px !important;float: left !important; margin: 0px 0px 25px 25px !important;"><img src="{{site.baseurl}}/assets/images/rotation45.png" style="width: 300px !important; float: left !important; margin: 0px 0px 25px 25px !important;"></picture> 

Let's take a point $P$ defined in a three-dimensional coordinate system with coordinate $(1,0,0)$. Ignore the $z$-axis for a while and assume that the point lies in the $xy$ plane. What we want is to transform the point from $P$ to $P_T$ by the mean of a rotation (we could do this with a translation but using a rotation will be easier). $P_T$ coordinates are $(0,1,0)$. 

As you can see, this can be done by rotating the point around the $z$-axis by $90$ degrees counterclockwise. Let's assume now that we have a matrix $R$. When $P$ is multiplied by $R$ it transforms $P$ into $P_T$. 

$$
\begin{aligned}
P_T.x = P.x * R_{00} + P.y * R_{10} + P.z * R_{20} \\
P_T.y = P.x * R_{01} + P.y * R_{11} + P.z * R_{21} \\
P_T.z = P.x & R_{02} + P.y * R_{12} + P.z * R_{22}
\end{aligned}
$$

As we said, we don't care so much about $P_T.z$ for now which represents the $z$-coordinate of $P_T$. Let's concentrate instead on $P_T.x$ and $P_T.y$ which represent respectively the $x$ and $y$ coordinates of $P_T$. From $P$ to $P_T$, the $x$-coordinate goes from $1$ to $0$. It means that $R_{00}$ has to be equal to $0$. Considering that $P.y$ and $P.z$ are 0 anyway we don't care much about the values that $R_{10}$ and $R_{20}$ may be for now. 

What do we know about $P$? We know that $P.x$ is 1 and that all the other coordinates of $P$ are $0$. Which necessarily means that $R_{01}$ has to be 1. 

Let's recap. We know that $R_{00}$ is 0 and $R_{01}$ is 1. Let's write it down and see what $R$ looks like: (compare this matrix with the identity matrix)

$$
R_z = 
\begin{bmatrix}
0 & 1 & 0 \\
1 & 0 & 0 \\
0 & 0 & 1 \\
\end{bmatrix}
$$

If you use this matrix to transform $P=(1,0,0)$ you will get $P_T = (0,1,0)$.

<h2> How Does Matrix Work? </h2>

<h3> Point-Matrix Multiplication </h3>

We will start to put all the things we have learned on points, vectors, matrices and coordinate systems together. We mentioned that two matrices needed to have compatible sizes in order to be multiplied with each other. The matrices of size $m \times p$ and $p \times n$ can be multiplied with each other. In computer vision, we would primarily deal with $4 \times 4$ matrices. 

A point or a vector is a sequence of three numbers and for this reason they too can be written as a $1 \times 3$ matrix, a matrix that has one row and three columns. Point written in a matrix form $P=[xyz]$. 

The trick here is that, if we can write points and vectors as $1 \times 3$ matrices, we can multiply them by other matrices. Remember that the matrix $m \times p$ can be multiplied by the matrix $p \times n$ to give the matrix $m \times n$. So this implies that we can multiply something of the form $3 \times n$ where n can be any number greater than 1. 

There is two things we need to remember now to make sense of what we are going to explain. The first one is that a point multiplied by a matrix transforms the point to a new position. The result of a point multiplied by a matrix has to be a point. If it wasn't the case, we wouldn't be using matrices as a convenient way of transforming points. The second thing we need to remember is that a $m \times p$ matrix multiplied by a $p \times n$ matrix, gives a $m \times n$ matrix. 

If we look at our point as a $1 \times 3$ matrix, we need the result of the multiplication to be another point, that is a $1 \times 3$ matrix. Multiplying a $1 \times 3$ matrix by a $3 \times 3$ matrix gives as expected, a $1 \times 3$ matrix which is another point. 

<h3> The Identity Matrix </h3>

The identity matrix or unit matrix is a square matrix whose coefficients are all $0$ except the coefficients along the diagonal which are set to $1$.

$$
\begin{bmatrix}
1 & 0 & 0 \\
0 & 1 & 0 \\
0 & 0 & 1
\end{bmatrix}
$$

The result of $P$ multiplied by the identity matrix is $P$.

<h3> The Scaling Matrix </h3>

If you look at the code of the point-matrix multiplication, you can see that the coordinates of the point $P$ are respectively multiplied by the coefficients $R_{00}$ for $x$, $R_{11}$ for $y$, and $R_{22}$ for $z$. When these coefficients are set to $1$ (and all the other coefficients are set to $0$), we get the identity matrix. 

However, when these coefficients (along the diagonal) are different than $1$ (whether smaller or bigger than $1$), then they act as a multiplier on the point's coordinates (in other words, the points coordinates are scaled up or down by some amount). If you remember what we have said about coordinate systems, multiplying the coordinates ofa point by some real numbers result in scaling the point's coordinates. The scaling matrix can therefore be written as:

$$
\begin{bmatrix}
S_X & 0 & 0 \\
0 & S_Y & 0 \\
0 & 0 & S_Z
\end{bmatrix}
$$

Note that if either one of the scaling coefficients in the matrix are negative, then the point's coordinate for the corresponding axis will be flipped (it will be mirrored to the other side of the axis). 

<h3> The Rotation Matrix </h3>

What we will be talking about now is about building a matrix that will rotate a point or a vector around one axis of the Cartesian coordinate system. And for doing so, we will need to use trigonometric functions. 

Let's take a point $P$ defined in a three-dimensional coordinate system with coordinate $(1,0,0)$. Let's ignore the $z$-axis for a while and assume that the point lies in the $xy$ plane. What we want is to transform the point from $P$ to $P_T$ by the mean of rotation (we could do this with a translation but using a rotation will make our demonstration easier). $P_T$ coordinates are $(0,1,0)$. This can be done by rotating the point around the $z$-axis by $90$ degrees counterclockwise. Let's assume now that we have a matrix $R$. When $P$ is multiplied by $R$ it transforms $P$ to $P_T$. Considering what we know about matrix multiplication let's see how we can re-write a point-matrix multiplication and isolate the computation of each of the transformed coordinates. 

$$
\begin{aligned}
P_T.x = P.x * R_{00} + P.y * R_{10} + P.z * R_{20} \\
P_T.y = P.x * R_{01} + P.y * R_{11} + P.z * R_{21} \\
P_T.z = P.x * R_{02} + P.y * R_{12} + P.z * R_{22}
\end{aligned}  
$$

As we said, we don't care so much about $P_T.z$ for now which represents the $z$-coordinate of $P_T$. Let's concentratte instead on $P_T.x$ and $P_T.y$ which represent respectively the $x$ and $y$ coordinates of $P_T$. From $P$ to $P_T$, the $x$-coordinate goes from $1$ to $0$. If we look at the first line of the code we wrote to compute $P_T$, it means that $R_{00}$ has to be equal to 0. Considering that $P.y$ and $P.z$ are $0$ anyway we don't care so much about the values that $R_{10}$ and $R_{20}$ may have for now. From P to $P_T$, the $y$-coordinate goes from $0$ to $1$. Let's have a look at the second line of code. What do we know about $P$? We know that $P.x$ is $1$ and that all the other coordinates of $P$ are $0$, which necessarily means that $R_{01}$ has to be $1$. Let's recap. We know that $R_{00}$ is $0$ and $R_{01}$ is $1$. Let's write it down and see what $R$ looks like (compare this matrix with the identity matrix):

$$
R_z = 
\begin{bmatrix}
0 & 1 & 0 \\
1 & 0 & 0 \\
0 & 0 & 1 
\end{bmatrix}
$$

Don't worry for now if you don't understand why the coefficients have the value they have. That will be explained soon. All you want to see, is that if you use this matrix to transform $P=(1,0,0)$ you will get $P_T=(0,1,0)$.

$$
\begin{aligned}
P_T.x = P.x * 0 + P.y * 1 + P.z * 0 = 0 \\
P_T.y = P.x * 1 + P.y * 0 + P.z * 0 = 1 \\
P_T.z = P.x * 0 + P.y * 0 + P.z * 1 = 0
\end{aligned}
$$

This is where our knowledge of trigonometric functions will become handy. If we look at a point on the unit circle we know that its $x$ and $y$ coordinates can be computed using the sine and cosine of the angle $\theta$. 

$$
\begin{aligned}
x = cos(\theta) = 0 \\
y = sin(\theta) = 1 \\
\theta = \frac{\pi}{2}
\end{aligned}
$$

When $\theta=0$, $x=1$ and $y=0$. When $\theta = 90$ degrees (or $\frac{\pi}{2}$), $x=0$ and $y=1$. That is interesting because you will notice that $x=0$ and $y=1$ are values of $R_{00}/R_{11}$ and $R_{01}/R_{10}$ respectively. So we could re-write the matrix $R$ as:

$$
R_z(\theta) = 
\begin{bmatrix}
cos(\theta) & sin(\theta) & 0 \\
sin(\theta) & cos(\theta) & 0 \\
0 & 0 & 1
\end{bmatrix}
= 
\begin{bmatrix}
0 & 1 & 0 \\
1 & 0 & 0 \\
0 & 0 & 1 
\end{bmatrix}
$$

<h3> Combining Rotation Matrices </h3>

We have learned that multiplying matrices together combines their transformations. Now that we know how to rotate points around individual axis, it is possible to multiply $R_x$, $R_y$, $R_z$ together to create more complex rotations. If for instance you want to rotate a point around the $x$-axis, and then the $y$-axis, you can create two matrices using the matrices $R_x$ and $R_y$ and combine them using matrix multiplication $R_x * R_y$ to create a $R_{xy}$ matrix encoding the two individual rotations. 

Note that the order of the rotation is important and makes a difference. If you rotate a point around the $x$-axis first and then the $y$-axis second, you will end up with a result which is different from a rotation around the $y$-axis and then around the $x$-axis. 

<h3> Relation Between Matrices and Cartesian Coordinate System </h3>

If you imagine that you have a point $P_x$ with coordinates $(1,0,0)$ and want to rotate this point around the $z$-axis by 10 degrees clockwise, we know that these new coordinates can be found using simple trigonometry. 

<h3> Orthogonal Matrices </h3>
 
In fact, the type of matrices we ahve described (the rotation matrices) are called in linear algebra, orthogonal matrices. An orthogonal matrix is a square matrix with real entries whose columns and rows are orthogonal unit vectors.

We have mentioned previously that each row from the matrix represents an axis of a Cartesian coordinate system. 


<h2> References </h2>
<ul><li><a href="https://www.scratchapixel.com"> scratchpixel </a></li>
</ul>

