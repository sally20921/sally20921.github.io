---
layout: post
title:  "NeRF: Representing Scenes as Neural Radiance Fields for View Synthesis"
author: seri
categories: [ computer vision ]
image: assets/images/depth/1.jpg
tags: featured
excerpt: "We present a method that achieves state-of-the-art results for synthesizing novel views of complex scenes by optimizing an underlying continuous volumetric scene function using a sparse set of input views. Our algorithm represents a scene using a fully-connected (non-convolutional) deep network, whose input is a single continuous 5D coordinate (spatial location and viewing direction) and whose output is the volume density and view-dependent emitted radiance at that spatial location. We synthesize views by querying 5D coordinates along camera rays and use classic volume rendering techniques to project the output colors and densities into an image. Because volume rendering is naturally differentiable, the only input required to optimize our representation is a set of images with known camera poses. We describe how to effectively optimize neural radiance fields to render photorealistic novel views of scenes with complicated geometry and appearance, and demonstrate results that outperform prior work on neural rendering and view synthesis. View synthesis results are best viewed as videos, so we urge readers to view our supplementary video for convincing comparisons."
---

<!--more-->

<h2> Introduction </h2>

In this work, we address the long-standing problem of view synthesis in a new way by directly optimizing parameters of a continuous 5D scene representation to minimize the error of rendering a set of captured images.

We represent a static scene as a continuous 5D function that outputs the radiance emitted in each direction $(\theta, \phi)$ at each point $(x,y,z)$ in space, and a density at each point acts like a differential opacity controlling how much radiance is accumulated by a ray passing through $(x,y,z)$. Our method optimizes a deep fully-connected neural network without any convolutional layers (often referred to as a multilayer perceptron or MLP) to represent this function by regressing from a single 5D coordinate $(x,y,z,\theta,\phi)$ to a single volume density and view-dependent RGB color. To render this neural radiance field (NeRF) from a particular viewpoint we march camera rays through the scene to generate a sampled set of 3D points, use those points and their corresponding 2D viewing directions as input to the neural network to produce an output set of colors and densities, and use classical volume rendering techniques to accumulate those colors and densities into a 2D image. 

Because this process is naturally differentiable, we can use gradient descent to optimize this model by minimizing the error between each observed image and the corresponding views rendered from our representation. Minimizing this error across multiple views encourages the network to predict a coherent model of the scene by assigning high volume densities and accurate colors to the locations that contain the true underlying scene content. 

We find that the basic implementation of optimizing a neural radiance field representation for a complex scene does not converge to a sufficiently high-resolution representation and is inefficient in the required number of samples per camera ray. We address these issues by transforming input 5D coordinates with a positional encoding that enables the MLP to represent higher frequency functions, and we propose a hierarchical sampling procedure to reduce the number of queries required to adequately sample this high-frequency scene representation. 

Our approach inherits the benefits of volumetric representations: both can represent complex real-world geometry and appearance and are well suited for gradient-based optimization using projected images. Crucially, our method overcomes the prohibitive storage costs of discretized voxel grids when modeling complex scenes at high-resolution. 

In summary, our technical contributions are: an approach for representing continuous scenes with complex geometry and materials as 5D neural radiance fields, parameterized as basic MLP networks. A differentiable rendering procedure based on classical volume rendering techniques, which we use to optimize these representations from standard RGB images. This includes a hierarchical sampling strategy to allocate the MLP's capacity towards space with visible scene content. A positional encoding to map each input 5D coordinate into a higher dimensional space, which enables us to successfully optimize neural radiance fields to represent high-frequency scene content. 

We demonstrate that our resulting neural radiance field method quantitatively and qualitatively outperforms state-of-the-art view synthesis methods, including works that fit neural 3D representations to scenes as well as works that train deep convolutional networks to predict sampled volumetric representations. As far as we know, this paper presents the first continuous neural scene representation that is able to render high-resolution photorealistic novel views of real objects and scenes from RGB images captured in natural settings. 

A promising recent direction in computer vision is encoding objects and scenes in the weights of an MLP that directly maps from a 3D spatial location to an implicit representation of the shape, such as the signed distance at that location. However, these methods have so far been unable to reproduce realistic scenes with complex geometry with the same fidelity as techniques that represent scenes using discrete representations such as triangle meshes or voxel grids. In this section, we review these two lines of work and contrast them with our approach, which enhances the capabilities of neural scene representations to produce state-of-the-art results for rendering complex realistic scenes. 

A similar approach to using MLPs to map from low-dimensional coordinates to colors has also been used for representing other graphics functions such as images, textured materials, and indirect illumination values. 

<h3> Neural 3D shape representations </h3>

Recent work has investigated the implicit representation of continuous 3D shapees as level sets by optimizing deep networks that map $xyz$ coordinates to signed distance functions or occupancy fields. However, these models are limited by their requirement access to ground truth 3D geometry, typically obtained from synthetic 3D shape datasets such as ShapeNet. Subsequent work has relaxed this requirement of ground truth 3D shapes by formulating differentiable rendering functions that allow neural implicit shape representations to be optimized using only 2D images. Niemeyer et al. represent surfaces as 3D occupancy fields and use numerical method to find the surface intersection for each ray, then calculate an exact derivative using implicit differentiation. Each ray intersection location is provided as the input to a neural 3D texture field that predicts a diffuse color for that point. Sitzmann et al. use a less direct neural 3D representation that simply outputs a feature vector and RGB color at each continuous 3D coordinate, and propose a differentiable rendering function consisting of a recurrent neural network that marches along each ray to decide where the surface is located.

Though these techniques can potentially represent complicated and high-resolution geometry, they have so far been limited to simple shapes with low geometry complexity, resulting in oversmoothed renderings. We show that an alternate strategy of optimizing networks to encode 5D radiance fields (3D volumes with 2D view-dependent appearance) can represent higher-resolution geometry and appearance to render photorealistic novel views of complex scenes. 


<h3> View synthesis and image-based rendering </h3>

Given a dense sampling of views, photorealistic novel views can be reconstructed by simple light field sample interpolation techniques. For novel view synthesis with sparser view sampling, the computer vision and graphics communities have madee significant progress by predicting traditional geometry and appearance representations from observed images. One popular class of approaches uses mesh-based representations of scenes with either diffuse or view-dependent appearance. Differentiable rasterizers or pathtracers can directly optimize mesh representations to reproduce a set of input images using gradient descent. However, gradient-based mesh optimization based on image reprojection is often difficult, likely because of local minima or poor conditioning of the loss landscape. Furthermore, this strategy requires a template mesh with fixed topology to be provided as an initialization before optimization, which is typically unavailable for unconstrained real-world scenes.

Another class of methods use volumetric representations to address the task of high-quality photorealistic view synthesis from a set of input RGB images. Volumetric approaches are able to realistically represent complex shapes and materials, are well-suited for gradient-based optimization, and tend to produce less visually distracting artifacts than mesh-based methods. Early volumetric approaches used observed images to directly color voxel grids. More recently, several methods have used large datasets of multiple scenes to train deep networks that predict a sampled volumetric representation from a set of input images, and then use either alpha-compositing or learned compositing along rays to render novel views at test time. Other works have optimized a combination of convolutional networks (CNNs) and sampled voxel grids for each specific scene, such that the CNN can compensate for discretization artifacts from low resolution voxel grids or allow the predicted voxel grids to vary based on input times or animation controls. While these volumetric techniques have achieved impressive rsults for novel view synthesis, their ability to scale to higher resolution imagery is fundamentally limited by poor time and space complexity due to their discrete sampling-rendering higher resolution images requires a finer sampling of 3D space. We circumvent this problem by instead encoding a continuous volume within the parameters of a deep fully-connected neural network, which not only produces significantly higher quality rendering than prior volumetric approaches, but also requires just a fraction of the storage cost of those sampled volumetric representations. 

<h2> Neural Radiance Field Scene Representation </h2>

We represent a continuous scene as a 5D vector-valued function whose input is a 3D location $x = (x,y,z)$ and 2D viewing direction $(\theta, \phi)$, and whose output is an emitted color $ c = (r,g,b)$ and volume density $\sigma$. In practice, we express direction as a 3D Cartesian unit vector $d$. We approximate this continuous 5D scene representation with an MLP network $ F_{\Theta}: (x,d) \rightarrow (c,\sigma)$ and optimize its weights $\Theta$ to map from each input 5D coordinate to its corresponding volume density and directional emitted color.

We encourage the representation to be multiview consistent by restricting the network to predict the volume density $\sigma$ as a function of only the location $x$, while allowing the RGB color $c$ to be predicted as a function of both location and viewing direction. To accomplish this, the MLP $F_{\Theta}$ first processes the input 3D coordinate $x$ with 8 fully-connected layers (using ReLU activations and 256 channels per layer), and outputs $\sigma$ and a 256-dimensional feature vector. This feature vector is then concatenated with the camera ray's viewing direction and passed to one additional fully-connected layer (using ReLU activation and 128 channels) that output the view-dependent RGB color. 

<h3> Volume Rendering with Radiance Fields </h3>

Our 5D neural radiance field represents a scene as the volume density and directional emitted radiance at any point in space. We render the color of any ray passing through the scene using principles from classical volume rendering. The volume density $\sigma(x)$ can be interpreted as the differential probability of a ray terminating at an infinitesimal particle at location $x$. The expected color $C(r)$ of camera ray $r(t) = o + td$ with near and far bounds $t_n$ and $t_f$ is: 

$$
C(r) = \int_{t_n}^{t_f} T(t) \sigma(r(t))c(r(t),d)dt
$$

where

$$
T(t) = \exp (-\int_{t_n}^{t} \sigma(r(s))ds)
$$

The function $T(t)$ denotes the accumulated transmittance along the ray from $t_n$ to $t$, i.e., the probability that the ray travels from $t_n$ to $t$ without hitting any other particle. Rendering a view from our continuous neural radiance field requires estimating this integral $C(r)$ for a camera ray traced through each pixel of the desired virtual camera.

We numerically estimate this continuous integral using quadrature. Deterministic quadrature, which is typically used for rendering discretized voxel grids, would effectively limit our representation's resolution because the MLP would only be queried at a fixed discrete set of locations. Instead, we use a stratified sampling approach where we partition $[t_n, t_f]$ into $N$ evenly-spaced bins and then draw one sample uniformly at random from within each bin:

$$
t_i ~ [t_n + \frac{i-1}{N} (t_f - t_n), t_n + \frac{i}{N}(t_f - t_n)]
$$

Although we use a discrete set of samples to estimate the integral, stratified sampling enables us to represent a continuous scene representation because it results in the MLP being evaluated at continuous positions over the course of optimization. We use these samples to estimate $C(r)$ with the quadrature rule discussed in the volume rendering review.

$$
\hat{C}(r) = \sum_{i=1}^N T_i (1 - \exp(-\sigma_i \delta_j)
$$

where $\delta_i = t_{i+1} - t_i$ is the distance between adjacent samples. This function for calculating $\hat{C}(r)$ from the set of $(c_i, \sigma_i)$ values is trivially differentiable and reduces to traditional alpha compositing with alpha values $\alpha_i =  1 - \exp (- \sigma_i \delta_i)$.

<h3> Optimizing a Neural Radiance Field </h3>

In the previous section we have described the core components necessary for modeling a scene as a neural radiance field and rendering novel views from this representation. However, we observe that these components are not sufficient for achieving state-of-the-art quality, as demonstrated. We introduce two improvements to enable representing high-resolution complex scenes. The first is a positional encoding of the input coordinates that assists the MLP in representing high-frequency functions, and the second is a hierarchical sampling procedure that allows us to efficiently sample this high-frequency representation.

<h4> Positional Encoding </h4>

Despite the fact that neural networks are universal function approximators, we found that having the network $F_{\Theta}$ directly operate on $xyz \theta \phi$ input coordinates results in renderings that perform poorly at representing high-frequency variation in color and geometry. This is consistent with recent work by Rahaman et al., which shows that deep networks are biased towards learning lower frequency functions. They additionally show that mapping the inputs to a higher dimensional space using high frequency functions before passing them to the network enables better fitting of data that contains high frequency variation. 

We leverage these findings in the context of neural scene representations, and show that reformulating $F_{\Theta}$ as a composition of two functions $F_{\Theta} = F_{\Theta}' \circ \gamma$, one learned and one not, significantly improves performance. Here, $\gamma$ is a mapping from $\mathbb{R}$ into a higher diemsnional space $\mathbb{R}^{2L}$, and $F_{\Theta}'$ is still simply a regular MLP. This function $\gamma(\cdot)$ is applied separately to each of the three coordinate values in $x$ to the three components of the Cartesian viewing direction unit vector $d$. In our experiments, we set $L=10$ for $\gamma(x)$ and $L=4$ for $\gamma(d)$.

A similar mapping is used in the popular Transformer architecture, where it is referred to as a positional encoding. However, Transformers use it for a different goal of providing the discrete positions of tokens in a sequence as input to an architecture that does not contain any notion of order. In contrast, we use these functions to map continuous input coordinates into a higher dimensional space to enable our MLP to more easily approximate a higher frequency function. Concurrent work on a related problem of modeling 3D protein structure from projections also utilizes a similar input coordinate mapping. 



<picture><img src="{{site.baseurl}}/assets/images/disparity.png"></picture>

<h2> References </h2>
<ul><li><a=href=""> TheAILearner </a></li>
</ul>

